---
layout: post
title: "JavaScript의 전역 스코프와 즉시 실행 함수 (IIFE)"
categories: [javascript]
comments: true
---

### 스코프 (Scope)
변수에 접근할 수 있는 범위를 해당 변수의 스코프, 유효 범위라 부른다. 자바스크립트에서는 변수를 유효 범위에 따라 2가지로 나누게 된다. 바로 **전역 변수**와 **지역 변수**이다.

- 전역 변수: 함수 밖에서 선언된 변수로서, 전체 프로그램에서 유효한 변수이다.
- 지역 변수: 함수 안에서 선언된 변수와 함수 인자로, 해당 변수가 선언된 함수 내부에서만 유효하다.

변수에 이러한 유효 범위가 있는 이유는 프로그램의 다른 부분에서 선언된 동명의 변수와 충돌하지 않도록 하기 위해서이다.

<br>

### 변수의 충돌
만약 전역 변수명과 지역 변수명이 같다면, 해당 두 변수는 충돌하게 된다. 이러한 경우에는 어떤 변수가 보여질 지 확인해보자.

``` js
var a = 'global';
function f() {
  var a = 'local';
  console.log(a); // -> 'local'
  return a;
}
f();
console.log(a); // -> 'global'
```

위의 코드를 실행시키면 순서대로 함수 `f()`를 호출하여 콘솔에 'local'이라는 문자열을 출력하고, 이후 `console.log(a)`를 실행해 'global'이라는 문자열을 출력한다.
어떻게 이러한 흐름으로 실행될 수 있었던 것일까? 자바스크립트는 이렇게 변수명이 충돌하게 되면, 전역 변수는 숨기고 지역 변수를 사용하도록 한다.

함수 밖에서 선언된 전역 변수 `a`와 함수 내에서 선언된 지역 변수 `a`가 있다. 이 둘은 이름은 같지만 메모리 상에서 다른 위치에 있는, 별개의 변수이다.
지역 변수 `a`의 스코프 안에서 전역 변수 `a`는 숨겨진다. 따라서 두 `console.log(a)`의 결과가 다르게 나온 것이다.

> ES6부터는, 변수를 선언하는 방법으로 `let`과 `const`라는 선언자가 추가되었다. 이들은 `var` 선언자와는 다르게 선언하려는 변수명과 동일한 변수가 이전에 선언되었다면, `SyntaxError`를 내보내 해당 변수명으로는 변수를 선언할 수 없도록 한다.

<br>

### 전역 이름 공간의 오염
변수나 함수를 전역 객체에 선언하는 행위를 '전역 유효 범위를 오염시킨다'라고 한다. 만약 이렇게 전역 스코프가 오염된다면 다음과 같은 상황에서 변수명이나 함수명이 겹치는 상황이 발생하기도 한다.

- 여러 개의 라이브러리를 읽어 들여 사용할 때
- 규모가 큰 프로그램을 만들 때
- 여러 사람이 함께 프로그램을 만들 때

전역 스코프 안에서 이름이 같은 변수나 함수를 선언하게 되면, 자바스크립트 엔진이 이를 프로그램의 첫 부분으로 끌어올림으로써 변수 또는 함수를 단 하나만 생성하도록 한다. 따라서 예기치 못한 오류를 발생시키곤 한다. 그렇다면 전역 스코프의 오염을 방지하고자 한다면 어떤 방법을 활용할 수 있는 지 알아 보자.

<br>

### 객체의 경우
네임 스페이스(Name space) 패턴을 이용하면 변수와 함수를 한 곳에 모아 둠으로써 이름 충돌의 문제를 방지하도록 할 수 있다.

이를 위해선 객체를 가지는 전역 변수를 하나 생성한 후에, 해당 객체 내에 프로그램에서 사용할 모든 변수와 함수를 프로퍼티로써 정의하도록 한다.

예를 들어 아래와 같은 방법으로 전역 변수를 네임 스페이스로 사용할 수가 있다.

``` js
var myApp = myApp || {}; // 만약 myApp이 정의되어 있으면 그것을 사용하고, 정의되지 않았다면 빈 객체를 할당

myApp.name = 'Tom';
myApp.showName = function() { ... };
```

<br>

### 함수의 경우
스코프의 정의에 따르면, 함수 내에서 선언된 변수의 유효 범위는 함수 내부로만 한정된다. 따라서 해당 변수는 함수의 안에선 읽거나 쓸 수가 있지만 바깥에선 읽거나 쓰는게 불가하다. 해당 성질에 의해 즉시 실행 함수 안에 변수를 선언하게 된다면 전역 스코프를 오염시키지 않고도 프로그램을 실행할 수 있다.

즉시 실행 함수 표현(**I**mmediately **I**nvoked **F**unction **E**xpression)이란, 정의되자마자 즉시 실행되는 자바스크립트 함수를 의미한다.


``` js
// IIFE 예시
(function () {
  ...
})();
// 혹은
(function() {
  ...
}());
```

위 코드를 살펴보면, 크게 두 가지 부분으로 구성되어 있다. 어떠한 부분으로 나눠져 있는지와 각각 무슨 역할을 하는 지에 대해 알아 보자.

1. 첫 번째 부분, 괄호 `()`로 둘러 싸인 익명 함수 (Anonymous Function)
  - 괄호로 묶인 함수 정의식은 그 안에서 평가되어 값(참조 값)으로 바뀐다.
  - 전역 스코프에 불필요한 변수 추가로 인한 오염을 방지시킨다.
  - IIFE 내부로 다른 변수들이 접근하는 것을 막는다.

2. 두 번째 부분, 즉시 실행 함수를 생성하는 괄호 `()`
  - 자바스크립트 엔진이 함수를 즉시 해석하여 실행하도록 한다.

즉시 실행 함수를 이용하여 전역 스코프를 오염시키지 않는 네임 스페이스를 생성해 보도록 하자.

``` js
var x = 'global x';
(function() {
  var x = 'local x';
  var y = 'local y';
})();
console.log(x); // -> global x
console.log(y); // -> Uncaught ReferenceError: y is not defined
```

즉시 실행 함수 내부에서 선언한 변수 `x`, `y`는 해당 함수의 지역 변수이므로 전역 변수와 이름이 충돌하지 않는다.

따라서, 만약 일시적인 처리를 수행하고자 한다면 해당 작업을 즉시 실행 함수에 작성한다. 또한 라이브러리를 불러와서 사용할 때 전역 변수가 충돌하지 않도록 하고자 한다면 프로그램 전체를 즉시 실행 함수 안에 넣어서 실행하도록 하는 방법으로도 활용할 수 있다.